{{- if .Values.dapr.enabled }}
apiVersion: dapr.io/v1alpha1
kind: Component
metadata:
  name: statestore
  namespace: {{ .Release.Namespace }}
spec:
  type: state.redis
  version: v1
  metadata:
    # Redis connection
    - name: redisHost
      {{- if .Values.dapr.statestore.inCluster }}
      value: "{{ include "todo-chatbot.fullname" . }}-redis:6379"
      {{- else if .Values.dapr.statestore.secretRef }}
      secretKeyRef:
        name: {{ .Values.dapr.statestore.secretRef }}
        key: redisHost
      {{- else }}
      value: {{ .Values.dapr.statestore.redisHost | quote }}
      {{- end }}

    {{- if and .Values.dapr.statestore.redisPassword (not .Values.dapr.statestore.inCluster) }}
    - name: redisPassword
      {{- if .Values.dapr.statestore.secretRef }}
      secretKeyRef:
        name: {{ .Values.dapr.statestore.secretRef }}
        key: redisPassword
      {{- else }}
      value: {{ .Values.dapr.statestore.redisPassword | quote }}
      {{- end }}
    {{- end }}

    {{- if and .Values.dapr.statestore.enableTLS (not .Values.dapr.statestore.inCluster) }}
    - name: enableTLS
      value: "true"
    {{- end }}

    # State store settings
    - name: actorStateStore
      value: {{ .Values.dapr.statestore.actorStateStore | default "true" | quote }}

    # Key prefix for namespacing
    - name: keyPrefix
      value: {{ .Values.dapr.statestore.keyPrefix | default "todo" | quote }}
{{- end }}
