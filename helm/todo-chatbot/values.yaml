# Global configuration
global:
  environment: development
  imageTag: local
  imagePullPolicy: Never

# Frontend configuration
frontend:
  replicaCount: 1
  image:
    repository: todo-frontend
    tag: local
  service:
    type: NodePort
    port: 80
    targetPort: 3000
    nodePort: 30080
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  probes:
    liveness:
      path: /
      initialDelaySeconds: 10
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      path: /
      initialDelaySeconds: 5
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
    startup:
      path: /
      failureThreshold: 30
      periodSeconds: 10
      timeoutSeconds: 10

# Backend configuration
backend:
  replicaCount: 1
  image:
    repository: todo-backend
    tag: local
  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  probes:
    liveness:
      path: /api/health
      initialDelaySeconds: 30
      periodSeconds: 30
      timeoutSeconds: 10
      failureThreshold: 3
    readiness:
      path: /api/health
      initialDelaySeconds: 15
      periodSeconds: 10
      timeoutSeconds: 10
      failureThreshold: 3
    startup:
      path: /api/health
      failureThreshold: 30
      periodSeconds: 10
      timeoutSeconds: 15

# Ingress configuration (optional)
ingress:
  enabled: false
  className: nginx
  annotations: {}
  hosts:
    - host: todo.local
      paths:
        - path: /
          pathType: Prefix
          service: frontend
        - path: /api
          pathType: Prefix
          service: backend
  tls: []

# ConfigMap values
config:
  environment: development
  appName: "Todo App (K8s) v2"
  corsOrigins: "http://localhost:30080,http://127.0.0.1:30080,http://localhost:3000,http://127.0.0.1:60143"
  betterAuthUrl: "http://todo-chatbot-frontend:80"
  backendUrl: "http://todo-chatbot-backend:8000"
  chatkitWorkflowId: ""
  mcpDefaultUserId: ""
  # Additional trusted origins for Better Auth (comma-separated)
  # Add minikube tunnel dynamic ports here
  betterAuthTrustedOrigins: "http://127.0.0.1:64624"

# Secrets (provide in values-local.yaml)
secrets:
  databaseUrl: ""
  betterAuthSecret: ""
  openaiApiKey: ""
  mcpApiKey: ""
  openaiDomainKey: ""

# WebSocket service configuration (Phase V)
websocket:
  enabled: true
  replicaCount: 1
  image:
    repository: todo-websocket
    tag: local
  service:
    type: ClusterIP
    port: 8001
    targetPort: 8001
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "250m"
  probes:
    liveness:
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      path: /health
      initialDelaySeconds: 5
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

# Recurring task service configuration (Phase V)
recurringTask:
  enabled: true
  replicaCount: 1
  image:
    repository: todo-recurring-task
    tag: local
  service:
    type: ClusterIP
    port: 8002
    targetPort: 8002
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "250m"
  probes:
    liveness:
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      path: /health
      initialDelaySeconds: 5
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

# Notification service configuration (Phase V)
notification:
  enabled: true
  replicaCount: 1
  image:
    repository: todo-notification
    tag: local
  service:
    type: ClusterIP
    port: 8003
    targetPort: 8003
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "250m"
  probes:
    liveness:
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 30
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      path: /health
      initialDelaySeconds: 5
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

# Dapr configuration (Phase V)
dapr:
  enabled: false  # Set to true for Dapr-enabled deployments
  pubsub:
    brokers: "redpanda:9092"
    consumerGroup: "todo-chatbot"
    authType: "none"  # Use "password" for SASL auth
    saslUsername: ""
    saslPassword: ""
    saslMechanism: "SCRAM-SHA-256"
    tlsEnabled: false
    tlsSkipVerify: false
    maxMessageBytes: "1048576"
    initialOffset: "newest"
    secretRef: ""  # Name of secret containing broker credentials
  statestore:
    redisHost: "redis:6379"
    redisPassword: ""
    enableTLS: false
    inCluster: false  # When true, uses in-cluster Redis deployed by this chart
    actorStateStore: "true"
    keyPrefix: "todo"
    secretRef: ""  # Name of secret containing Redis credentials
  secretstore:
    enabled: true

# In-cluster Redis configuration
redis:
  enabled: false  # Set to true to deploy Redis in-cluster
  image:
    repository: redis
    tag: 7-alpine
    pullPolicy: IfNotPresent
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "250m"
  probes:
    liveness:
      initialDelaySeconds: 5
      periodSeconds: 10
      timeoutSeconds: 3
      failureThreshold: 3
    readiness:
      initialDelaySeconds: 3
      periodSeconds: 5
      timeoutSeconds: 3
      failureThreshold: 3
  persistence:
    enabled: false
    storageClass: ""
    size: "1Gi"

# In-cluster PostgreSQL configuration
postgresql:
  enabled: false  # Set to true to deploy PostgreSQL in-cluster
  image:
    repository: docker.io/library/postgres
    tag: 16-alpine
    pullPolicy: IfNotPresent
  database: "tododb"
  username: "todouser"
  password: ""
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  probes:
    liveness:
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      failureThreshold: 3
    readiness:
      initialDelaySeconds: 5
      periodSeconds: 5
      timeoutSeconds: 3
      failureThreshold: 3
  persistence:
    enabled: false
    storageClass: ""
    size: "5Gi"
